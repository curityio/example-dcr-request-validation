<config xmlns="http://tail-f.com/ns/config/1.0">
  <environments xmlns="https://curity.se/ns/conf/base">
    <environment>
      <base-url>https://localhost</base-url>
      <admin-service>
        <http>
          <ssl-server-keystore>default-admin-ssl-key</ssl-server-keystore>
          <web-ui/>
          <restconf>
          </restconf>
        </http>
      </admin-service>
      <services>
        <zones>
          <default-zone>
            <symmetric-key>data:text/plain;aes,v:S.M01xZmdkWE92TmhpZDRIQQ==.j0xicujZniMXE755_uhWRA==.VIWuzGkuyNgJ65nLl1bL-EWSIBi7EADdgEH0sttnQlKXqWp5wqYNj7n0OK4kRHhZWj8BHcSszd2a2fXrLYnhGwpY9tLtFW8DAZgY1XtL3hc=.s0T0c3k_l0T-0VBHRXLBgGJ3Z5jBAr0bKVHNu4Y7OZY=</symmetric-key>
          </default-zone>
        </zones>
        <service-role>
          <id>default</id>
          <protocol>https</protocol>
          <ssl-server-keystore>default-admin-ssl-key</ssl-server-keystore>
          <enable-http-v2>true</enable-http-v2>
          <mutual-tls>
            <client-truststores>#{OBB_CLIENT_TRUSTSTORE_ID}</client-truststores>
          </mutual-tls>
          <endpoints>authentication-service-anonymous</endpoints>
          <endpoints>authentication-service-authentication</endpoints>
          <endpoints>authentication-service-registration</endpoints>
          <endpoints>token-service-anonymous</endpoints>
          <endpoints>token-service-authorize</endpoints>
          <endpoints>token-service-dynamic-client-registration</endpoints>
          <endpoints>token-service-introspect</endpoints>
          <endpoints>token-service-revoke</endpoints>
          <endpoints>token-service-session</endpoints>
          <endpoints>token-service-token</endpoints>
          <endpoints>token-service-userinfo</endpoints>
        </service-role>
      </services>
    </environment>
  </environments>
  <profiles xmlns="https://curity.se/ns/conf/base">
    <profile>
      <id>authentication-service</id>
      <type xmlns:auth="https://curity.se/ns/conf/profile/authentication">auth:authentication-service</type>
      <settings>
        <authentication-service xmlns="https://curity.se/ns/conf/profile/authentication">
          <authenticators>
            <authenticator>
              <id>username</id>
              <username xmlns="https://curity.se/ns/ext-conf/username">
              </username>
            </authenticator>
          </authenticators>
          <protocols>
            <protocol>
              <id>default-simple-protocol</id>
              <simple-api/>
            </protocol>
          </protocols>
        </authentication-service>
      </settings>
      <endpoints>
        <endpoint>
          <id>authentication-service-anonymous</id>
          <uri>/authn/anonymous</uri>
          <endpoint-kind>auth-anonymous</endpoint-kind>
        </endpoint>
        <endpoint>
          <id>authentication-service-authentication</id>
          <uri>/authn/authentication</uri>
          <endpoint-kind>auth-authentication</endpoint-kind>
        </endpoint>
        <endpoint>
          <id>authentication-service-registration</id>
          <uri>/authn/registration</uri>
          <endpoint-kind>auth-registration</endpoint-kind>
        </endpoint>
      </endpoints>
      <token-issuers>
        <default-token-issuer>
          <jwt-issuer-settings>
            <signing-key-id>default-signing-key</signing-key-id>
          </jwt-issuer-settings>
          <default-data-source>default-datasource</default-data-source>
        </default-token-issuer>
      </token-issuers>
    </profile>
    <profile>
      <id>token-service</id>
      <type xmlns:as="https://curity.se/ns/conf/profile/oauth">as:oauth-service</type>
      <expose-detailed-error-messages/>
      <settings>
        <authorization-server xmlns="https://curity.se/ns/conf/profile/oauth">
          <client-authentication>
            <basic-and-form-post>false</basic-and-form-post>
            <asymmetrically-signed-jwt>
              <signature-algorithm>PS256</signature-algorithm>
              <signature-algorithm>ES256</signature-algorithm>
            </asymmetrically-signed-jwt>
            <mutual-tls>
            </mutual-tls>
          </client-authentication>
          <request-object>
            <asymmetrically-signed-jwt>
              <signature-algorithm>PS256</signature-algorithm>
            </asymmetrically-signed-jwt>
            <maximum-lifetime>60</maximum-lifetime>
            <required-claim>aud</required-claim>
            <required-claim>exp</required-claim>
            <required-claim>nbf</required-claim>
            <request-object-parameter-handling>must-be-inside-and-match-if-outside</request-object-parameter-handling>
          </request-object>
          <authentication-service>
            <authentication-profile>authentication-service</authentication-profile>
          </authentication-service>
          <client-capabilities>
            <code>
              <disallowed-proof-key-challenge-methods>plain</disallowed-proof-key-challenge-methods>
            </code>
            <implicit/>
            <client-credentials/>
            <introspection/>
            <token-exchange/>
          </client-capabilities>
          <scopes>
            <scope>
              <id>accounts</id>
            </scope>
            <scope>
              <id>address</id>
              <description>OpenId Connect address scope</description>
              <claims>address</claims>
            </scope>
            <scope>
              <id>consents</id>
            </scope>
            <scope>
              <id>credit-cards-accounts</id>
            </scope>
            <scope>
              <id>customers</id>
            </scope>
            <scope>
              <id>email</id>
              <description>OpenId Connect email scope</description>
              <claims>email</claims>
              <claims>email_verified</claims>
            </scope>
            <scope>
              <id>financings</id>
            </scope>
            <scope>
              <id>invoice-financings</id>
            </scope>
            <scope>
              <id>loans</id>
            </scope>
            <scope>
              <id>openid</id>
              <description>Standard OpenID Connect scope</description>
              <required>true</required>
            </scope>
            <scope>
              <id>payments</id>
            </scope>
            <scope>
              <id>phone</id>
              <description>OpenId Connect phone scope</description>
              <claims>phone_number</claims>
              <claims>phone_number_verified</claims>
            </scope>
            <scope>
              <id>profile</id>
              <description>OpenId Connect profile scope</description>
              <claims>birthdate</claims>
              <claims>family_name</claims>
              <claims>gender</claims>
              <claims>given_name</claims>
              <claims>locale</claims>
              <claims>middle_name</claims>
              <claims>name</claims>
              <claims>nickname</claims>
              <claims>picture</claims>
              <claims>preferred_username</claims>
              <claims>profile</claims>
              <claims>updated_at</claims>
              <claims>website</claims>
              <claims>zoneinfo</claims>
            </scope>
            <scope>
              <id>resources</id>
            </scope>
            <scope>
              <id>unarranged-accounts-overdraft</id>
            </scope>
          </scopes>
          <claims>
            <claim>
              <name>address</name>
              <description>OpenID Connect address claim</description>
              <value-provided-by>account-manager-claims-provider</value-provided-by>
            </claim>
            <claim>
              <name>birthdate</name>
              <description>OpenID Connect birthdate claim</description>
              <value-provided-by>account-manager-claims-provider</value-provided-by>
            </claim>
            <claim>
              <name>email</name>
              <description>OpenID Connect email claim</description>
              <value-provided-by>account-manager-claims-provider</value-provided-by>
            </claim>
            <claim>
              <name>email_verified</name>
              <description>OpenID Connect email_verified claim</description>
              <value-provided-by>account-manager-claims-provider</value-provided-by>
            </claim>
            <claim>
              <name>family_name</name>
              <description>OpenID Connect family_name claim</description>
              <value-provided-by>account-manager-claims-provider</value-provided-by>
            </claim>
            <claim>
              <name>gender</name>
              <description>OpenID Connect gender claim</description>
              <value-provided-by>account-manager-claims-provider</value-provided-by>
            </claim>
            <claim>
              <name>given_name</name>
              <description>OpenID Connect given_name claim</description>
              <value-provided-by>account-manager-claims-provider</value-provided-by>
            </claim>
            <claim>
              <name>locale</name>
              <description>OpenID Connect locale claim</description>
              <value-provided-by>account-manager-claims-provider</value-provided-by>
            </claim>
            <claim>
              <name>middle_name</name>
              <description>OpenID Connect middle_name claim</description>
              <value-provided-by>account-manager-claims-provider</value-provided-by>
            </claim>
            <claim>
              <name>name</name>
              <description>OpenID Connect name claim</description>
              <value-provided-by>account-manager-claims-provider</value-provided-by>
            </claim>
            <claim>
              <name>nickname</name>
              <description>OpenID Connect nickname claim</description>
              <value-provided-by>account-manager-claims-provider</value-provided-by>
            </claim>
            <claim>
              <name>phone_number</name>
              <description>OpenID Connect phone_number claim</description>
              <value-provided-by>account-manager-claims-provider</value-provided-by>
            </claim>
            <claim>
              <name>phone_number_verified</name>
              <description>OpenID Connect phone_number_verified claim</description>
              <value-provided-by>account-manager-claims-provider</value-provided-by>
            </claim>
            <claim>
              <name>picture</name>
              <description>OpenID Connect picture claim</description>
              <value-provided-by>account-manager-claims-provider</value-provided-by>
            </claim>
            <claim>
              <name>preferred_username</name>
              <description>OpenID Connect preferred_username claim</description>
              <value-provided-by>account-manager-claims-provider</value-provided-by>
            </claim>
            <claim>
              <name>profile</name>
              <description>OpenID Connect profile claim</description>
              <value-provided-by>account-manager-claims-provider</value-provided-by>
            </claim>
            <claim>
              <name>updated_at</name>
              <description>OpenID Connect updated_at claim</description>
              <value-provided-by>account-manager-claims-provider</value-provided-by>
            </claim>
            <claim>
              <name>website</name>
              <description>OpenID Connect website claim</description>
              <value-provided-by>account-manager-claims-provider</value-provided-by>
            </claim>
            <claim>
              <name>zoneinfo</name>
              <description>OpenID Connect zoneinfo claim</description>
              <value-provided-by>account-manager-claims-provider</value-provided-by>
            </claim>
            <claims-value-provider>
              <id>account-manager-claims-provider</id>
              <account-manager-claims-provider xmlns="https://curity.se/ns/ext-conf/account-manager-claims-provider">
                <account-manager>
                  <id>default-account-manager</id>
                </account-manager>
              </account-manager-claims-provider>
            </claims-value-provider>
            <claims-mappers>
              <claims-mapper>
                <id>default</id>
                <id_token>
                  <claim>address</claim>
                  <claim>birthdate</claim>
                  <claim>email</claim>
                  <claim>email_verified</claim>
                  <claim>family_name</claim>
                  <claim>gender</claim>
                  <claim>given_name</claim>
                  <claim>locale</claim>
                  <claim>middle_name</claim>
                  <claim>name</claim>
                  <claim>nickname</claim>
                  <claim>phone_number</claim>
                  <claim>phone_number_verified</claim>
                  <claim>picture</claim>
                  <claim>preferred_username</claim>
                  <claim>profile</claim>
                  <claim>updated_at</claim>
                  <claim>website</claim>
                  <claim>zoneinfo</claim>
                </id_token>
                <userinfo>
                  <claim>address</claim>
                  <claim>birthdate</claim>
                  <claim>email</claim>
                  <claim>email_verified</claim>
                  <claim>family_name</claim>
                  <claim>gender</claim>
                  <claim>given_name</claim>
                  <claim>locale</claim>
                  <claim>middle_name</claim>
                  <claim>name</claim>
                  <claim>nickname</claim>
                  <claim>phone_number</claim>
                  <claim>phone_number_verified</claim>
                  <claim>picture</claim>
                  <claim>preferred_username</claim>
                  <claim>profile</claim>
                  <claim>updated_at</claim>
                  <claim>website</claim>
                  <claim>zoneinfo</claim>
                </userinfo>
              </claims-mapper>
              <default-claims-mapper>default</default-claims-mapper>
            </claims-mappers>
          </claims>
          <openid-connect>
            <expose-metadata>
            </expose-metadata>
          </openid-connect>
          <dynamic-client-registration>
            <client-data-source>default-datasource</client-data-source>
            <non-templatized>
              <capabilities>
                <code/>
                <implicit/>
                <client-credentials/>
              </capabilities>
              <require-request-object/>
              <scopes>
                <all/>
              </scopes>
              <authenticators>
                <all/>
              </authenticators>
              <client-authentication-method>
                <mutual-tls>
                  <trusted-cas>
                    <trusted-ca>#{OBB_CLIENT_TRUSTSTORE_ID}</trusted-ca>
                  </trusted-cas>
                </mutual-tls>
                <asymmetrically-signed-jwt>
                  <signature-algorithms>
                    <signature-algorithm>PS256</signature-algorithm>
                    <signature-algorithm>ES256</signature-algorithm>
                  </signature-algorithms>
                </asymmetrically-signed-jwt>
              </client-authentication-method>
              <mutual-tls>
                <trusted-issuers>#{OBB_CLIENT_TRUSTSTORE_ID}</trusted-issuers>
              </mutual-tls>
            </non-templatized>
            <client-management>
            </client-management>
          </dynamic-client-registration>
        </authorization-server>
      </settings>
      <endpoints>
        <endpoint>
          <id>token-service-anonymous</id>
          <uri>/oauth/v2/oauth-anonymous</uri>
          <endpoint-kind>oauth-anonymous</endpoint-kind>
        </endpoint>
        <endpoint>
          <id>token-service-authorize</id>
          <uri>/oauth/v2/oauth-authorize</uri>
          <endpoint-kind>oauth-authorize</endpoint-kind>
        </endpoint>
        <endpoint>
          <id>token-service-dynamic-client-registration</id>
          <uri>/oauth/v2/oauth-dynamic-client-registration</uri>
          <client-authentication>allow</client-authentication>
          <endpoint-kind>oauth-dynamic-client-registration</endpoint-kind>
          <pre-processing-procedure>test-obb</pre-processing-procedure>
        </endpoint>
        <endpoint>
          <id>token-service-introspect</id>
          <uri>/oauth/v2/oauth-introspect</uri>
          <endpoint-kind>oauth-introspect</endpoint-kind>
        </endpoint>
        <endpoint>
          <id>token-service-revoke</id>
          <uri>/oauth/v2/oauth-revoke</uri>
          <endpoint-kind>oauth-revoke</endpoint-kind>
        </endpoint>
        <endpoint>
          <id>token-service-session</id>
          <uri>/oauth/v2/oauth-session</uri>
          <endpoint-kind>oauth-session</endpoint-kind>
        </endpoint>
        <endpoint>
          <id>token-service-token</id>
          <uri>/oauth/v2/oauth-token</uri>
          <endpoint-kind>oauth-token</endpoint-kind>
        </endpoint>
        <endpoint>
          <id>token-service-userinfo</id>
          <uri>/oauth/v2/oauth-userinfo</uri>
          <endpoint-kind>oauth-userinfo</endpoint-kind>
        </endpoint>
      </endpoints>
      <token-issuers>
        <default-token-issuer>
          <jwt-issuer-settings>
            <algorithm>PS256</algorithm>
            <signing-key-id>default-signing-key</signing-key-id>
          </jwt-issuer-settings>
          <default-data-source>default-datasource</default-data-source>
        </default-token-issuer>
      </token-issuers>
    </profile>
  </profiles>
  <facilities xmlns="https://curity.se/ns/conf/base">
    <data-sources>
      <data-source>
        <id>default-datasource</id>
        <jdbc xmlns="https://curity.se/ns/ext-conf/jdbc">
          <connection-string>jdbc:hsqldb:file:${se.curity:identity-server:db};ifexists=true;hsqldb.lock_file=false</connection-string>
          <driver>org.hsqldb.jdbc.JDBCDriver</driver>
          <username>SA</username>
        </jdbc>
      </data-source>
    </data-sources>
    <crypto>
      <ssl>
        <server-keystore>
          <id>default-admin-ssl-key</id>
          <keystore>data:application/p12;aes,v:S.MEpQZ3FJckZEMFpYSGE2OQ==.Rq_fVAtlePNQ8Pl7PR7PSw==.f-sHVSWx2W_gkgwoFG3xb-PDT-NQaZv4crLoMz0i8m7tFS66YqtPr4FO9ovrSk_Zp_Jtn_UhBcHfjVhBJyUbIsT7Tg7ELESfuHBaylIA8iTSNfgm36R_wYNGEaY7NsdgEqRvaVghUYXaFZ9rzNkRZNok1Z3FjacEIMt03kWMkJKclTlKAlFqdJSvUPlpNhRBpKZOO_nitaoEV6TWynjZVwxJQixAm5PySX9p4Yxnb4ycX4k0Ix3pTv0Q2po9T4WZCIPu-beFpxyyjxWAEZCyUN2YsON-0Kw6d13fJxO4EcaGJGdnIQOC9XvPyxtqqdnrTU4DY9N_TNPWoWJj6EDXTGqJ6HMvN8vQ-UFWIQQTPNvw9e1ILOGZ2LKLVITNIEYwBaSV_4K6g71SUDHTl8Sq2_PaabSIjDGV5C_68GLdsr1p23LLqqn_ZuGgtTrSvixrhFPvofhqrNxFXJ_KsVQuil8fX8KDyUv1maqKLKdaPltcNvr2opsFjvv7PsHV5rPxKs_ctnONVXj9M-VZBKG6vUeGFSru5UmjnJYdPXX5mcLZ75O3d0QcqniD4xKJBe7U_Psb-IGYiKTLuscPB-MvAVI8XDsktRjTEhc7lRs0eLDlta8_HSxG8h0Ih4mW4h7ryljW5I2UdhmD4ic9nPulgwel6P2-9AknV-0RKmyhm8DVCjNjiP3WSlqYirnIbso8QZ-WMOXexhcD4dnvpchJDjab55sK_Q3Eqzs8E8ke8QA1gi5H3WHPcRG8vSRQ2Ae2HthxeNgeQxVJJRpBcEivCb53kD2bnpbBs_od_nesq83LlsInjIzVsa8RnvuIJ7b2rW44UunJuvImkt0w3e-b8PU108EqMkw7xV4k-agw9iiKIDZRYVyQsi18Tg2bDyOS76DuEFmpVs6FDz6OTr20WNdx7smkOSJUXNuxYTEShRW6bdDKoWILC-ZbCdub_FBH8AjhzymL9CQR95zEDCjnsDGWQkUW2NUa5IUiTsiwKhloX8MDnbV3iIUeaLTa0AlNatJEw1KOf30EacYE3AjwjhwhFRQVeWDCL11NM859AGnhkdiYZEgp0d-b8iecHHZzzPRr0z11duNBKnazWoL0yt2LEDp0Ce5ZO7cK6yafcwEJb7wv4RgJeAuCInJQ40ZfkBI9-N7VTfVZPsIfn5n28E710ZDv1paznKyKlfL4c8owyeJyLqakF4m3DffMVk9ZFxuBoVWgfBaCpMUboRuM2kzq_ZOu3ohcYn8E9PnWDk89O9MXFBi7U8V_uywiWgALunVkLUCIXU2pE32JvnuRAS9lcrJ-XY8VVzIVb92ibA_X5c8M1ad0ZXxEaQlokwdFskGGYChglZT0eBQzRq2MNQsWSbToYNWoYTOs7uiXTn3PbGhi734N55K8d684hnw88lomzU4T41G4bihP5lzRXuIyDwJunRiEbzgWb2KsRJTrjQM186NRiMWbkPSNVGsd7yb67r3KmZuH1xdhnCA6lBo00rq8I8gatdrYttk_qo0TCHdnGbC2-E_l_ROhiAkHpiPX1uBIru7vkZbGiyU4uUshW0R1wic0hhHt4Vs6cFVLWCoOU7CJ27rYFgzg-YlfDjusFBjz4_pv9k06ydxe00KV_4h8JFw1eQYVXoFb8ArlQ4yJK03ksBsKmRWgrl2ghsfs387WQaVL6a9MV7S2QGO11l53-9vVqKl97FRltcRUuevVOonyAz-8s2cUa--PMfhE20Rrfb-FQCSFeSunK9gqeU7TShdv2DVl7ryDAhWgk7Dhxa_bXkS_YVmLga6JpWp6kG9-k_dMcqGUFibE2FzyVV7CRhPZav-ZZYk7_8L2XGvS38XDrWwZKY_IbTx-B7Gfkv0lsfJEFro7Wvs3QV4_YEyR01giymKzQOpQeHObTKbvjLK5p1NJ6D5ZaC3tHd8q5nNszPsr0o8o9mEMJxUNiwjjB9zoOtqDQsbttHLtrJGLDSHcKyOUChN5DgJA7tbbVy-BmxSeXW143GuGsSOf4c3dkyny4IrRbiLaOpW1NhyaTeKIUqMbej3mtajXv1nHRHIx8BszBnjeTQYpLXng-7F7rsZnmuwsyUHuxKbvZWy8VTc2InrNyVCB4wBPFIku-N8stKciR--Qzcz2gtZBUWkF-rZEb8sffN8H4YvZFG0bsP_tPhHCdRWyag0QGjTHnW5SrJgiEW-UiQeLTVEwRMc57e8Rf_YWdOJzHWm0PPUdaxgNeVOs_CB3wR_X7VJo1eb7HZXU6dN-xffhc6eV9_lwvw4EE_g4k7qd860UhXF5h6XQfsHXzuUVx24QdXvPzm-i_KGuCqTapYPKC99SdaSwRkW7fwGOlL8ai8Rp0dZehjbI4mdLconcSIPYkd14Mn3fl309f5nik94AydxI1v3Dk6yPtnmqk_z7CYFoAownOFkwWq_fZnEjyKjPKuf6xrDscRLCFogFHRefBMLxtOFiuSou8Q-T5srSS9qrTmFsaXbSo4iJJbT7H1GTZ4Fryds0d2_4okzVFYTWT-RGo7Y2zIbnsS7hZLFoqzQLgVfyzBPnpTZ1nJHeZzR25JmpexTsOhsuOKbt_zwkhvv39WSmQ0xNwnLc4Z7XV_F2mtJY_nJP0_b670S_d7VTumUGcLhc_lcfVqfqHsvnT9Yk7WZ3gjWQOHcR41QYqVfS-A_Zn47cjo5XDgh5SngDhoAk-WJSUQo0_KwzcYjgUtK6gkIp9oyfFaFHLttF6MXoCDBNCu5TzWFGKCBxUHlGpPX3tu5bp56CSS2z-0BZJnr4_3lIUom7ZEYfSIzr_7n0Eg8P2wDOrBCQKFMuJgVtZtKgsuOsy9or8r2SXRqmIrfgtgNp9z5kYfbqYdZpQ8zN6UB0YWdgtld8woi6xWRTKcAaNyeoYz6hS74PQ0JUd9r1P_og75nL_I-oTfYP5TAV2Fwdr2z25o5slb5yumrw7iOvQSBPX3O__EirlRiGSf-l05swKOp8aDTapcNCijDd1yK4zLAamdoKyaqSDDqdDrzcZLT-aVMmy5IwXBgWMU2omHHnV6PuNbfsz3WVjSlLeuxWBvnvPJ4pTwE5ewXl60wcNI9dYsQN9Jw7YSIf2NeGbPwxHVnsWuAk_g5CF-4Fe66fuzzMT0CynPacQOdrlBCbfHMV8VMSS6f0hpFKg4k-GowzzukegmLiog1LX5S4MTQ9Yda3ahH0BcQ8uoiPCO4tMnwoaBQuTBxBQoafi6G3ze5MFRg57R798NXgO77IEFfKhOEaONg95WqmX61N58lstZeYhZYl7xijyo3yCQYYfiDdgWJUlpJzEmIahq_8Ee3RH8d2FInRvwiJbnaFRfpQHJMHbNOVNi87rzpyH8Kr55-BBmXKRxmSEBSqx5xVTqRTxLycknXVB7XGf4PCbgZwZ1rHYXuJPpGHRmfnIOb5Yy-UTs2JXuj7lXWF74_OKnobQ0mBw3xBmtAdlNxOUHJmRPsuvTXqlX9NzbMouA==.NucgU_DwKV70hJNbXlde1cswcGGg9S59O24GpCU59IQ=</keystore>
        </server-keystore>
      </ssl>
      <signing-keys>
        <signing-key>
          <id>default-signing-key</id>
          <keystore>data:application/p12;aes,v:S.VlVTZmtFbE02bGM2UlNEZw==.4ilVJ07pXEWCDjqn3A40Mw==.gKBLP5Y3l_ugRiMPfxVrWlQrefbzsOp57CrYsBfIpDPTd0ZxbpRMTaH1vLR1wdSOedhDeoo4jg946kTq53vddn8g11259sdToozDXrksOr9q4igNHYOeYMO8cPQS8ArcWhND34WxmdoVw-Ptz_gizP1E8RwT537r1dOXPz3zmyIKjNcZNAeQhf_s517Z8F_WFQL-0o8092d2eegtEpKxpE7QN3FlwC_p-M3aS2DzlAJ7n4P0JNjoHLH0qS_p2ck_S4SKXVQf_B6bM-M1FKSKFVV-3S7GsPXJtTwDMWLgZNjmTeOlOt0ej8oR4Y9PZooHUVYO7CEdZ_t51vMRwqnoe8KKeErWI60RJmasYotjgMei0RH6u4mixD5oSNEOk-rqrP8JoBISAwRynh3oc4em26ymragCT_v5sSWUzW5xGXiZcL-5JiSUXzYXTNOvBEiVb7uf7uFzApyebscl4P3_DAB9Rm2PHAepPmvbs4dYsaEKPAdC0pvC2oZuvwE2MwrnaZ9OiGpge85tRF23dN883qLC0iIHR8yOLx85Ce8NxBJV6dw3fWe5xuMcb7UWEOU_6iU8gTYGGd5Yy_wRKXFDTh9tQjAAiTr4v3yedvCItNah6TTh6nomU6uNBlng-Zxj3IvMBVXs5bG3GBbhiu9E5moQ9kGWgP47PixVoKRbakiuYh08eVpCmoC53nm5ZyHDq2yU0Jak7YDDSR9rtKiggdbkFQy6xyrGNKY41rMl0zaP2BO4bIC1130mB05xtC50Api7_DGDT4IFktL4KUeXIXj06ahavxaXSKD5_stEkzLA2wCl5xftmjmZjM6WY0c80WGRrphKy0iPLt8i9n58OF-nENOhzmV8GjJWO55nxFjgirVbdzX4xww6z9LXTp4S-qSDU7fXzQFTAVai2oBSyaSd8mVxmMm8hDRy5jVZcZa3T5_5lhdonZUAJGA8x7zbzaYeyGYTnqgNb80yYpAsGK658W7UoHKSSB3oL5z5hJrc7aQ1-B1zvppleftex_-QqdMm-EMkQ_mONYiquik97jUAhl1svcdAg8xcXKCTnoqC9HrutqnDN7Gv6Gnj7juOTmQl7ufcRqz8zbDdiFW0zGDTCncHMpNAV5uk1ivv8YWpUmgt1mxqr7cPpp8HJ7md-98ZPwEZu4OuJzGZFGnP1OyXeyswDqn6G_xhOAqzqy8rHSAtwbnqTpPjOpbvsaSZvRR5HlLSk_VIFtzPyEQo4mDk1yfpkG49h6ClL44Sd92mADsITS6DOhxoe-LWehxplIWAi747eBMxNgCejI0N624whxhkb-osGQ3FcXoHpjrb1wXxZfhJ2KfoxZkhEK-wafAQI7D5byBeVISTeUpmA8uiEAuc_1xhBX9DeYxsCSXg_qxhhxm5TCjY3y6Tl5f74QqTW8ipfz8rBrNJlIe9fHnN3zougVu8a_ke8-jdN3I9GwsB1_6jC34fGiwLDMpnd6QstC9mSr5dJUXgFq_wFz4BCepbNu3NBXq_dOo-iZheMJyXlSac8TxQj8GFcgL414QkQew_duTI4pyIAsESxefAC56sie80yGieTcslSAydfJC7MlC6Xl8tGYqM8K046TQP8rXv1AT0nvvQB53EmjsP1Br3LGx30HSlvjj1S7BzSTnqtGPx5ycdubWNrnpFlupCxNy2jykEEB8rR7UoimXxBKjZAYdKK-8PbmB5bbAwV1sMT9w6GoE65a-MEl9yCkoX7SMuespAQxp6Kbhb7kWcJfuDIKb9XLLKifbRqlywovcRZZDh8OW-x3PdwPpTCIpfEtSxsQiY-xwL9bwn5q9eO54gODtgzYgdIX4IV98kspOekWUNZOE5xsq_ZF2qEJhDQM8hrq-RhDRTc7tmaEYxF8V5HkIdEYQnf5GwQ3RX6I_0XqERARqyLRAcnNwUK9qse_O15b-V6CoYyIjTt-jr0yCgyNl9kloD412sTTD90AFKprPw9XpK0209mi22_YFhZeZAhHUuMUHjunjAYTKSGFsx-gflsgZz4tCxgJGrHpCMWcjHA5z9mIivComFEkcMQqsgeq9FboAznhJHOpyfxkCeYV4kqk0ZFIUmkI8ui6Hajgm2hItawz-onxILshMkPCap5-FAhq3xEg4z66yKyU-p-LWH-9SX5n3PLyT8SG92ePQqGenS9wwJCILmHnjZP0PYIcx7Kq6Fc97_SLvnBTW9QtqxLP8BwM88J1PHQacYX9v8hXcVc2x1fm9W-g9c_Om7RSkWSHBcv-7MWXrj9QxWX2s1BAYYfCm2rlIYgoguqVobiFcvPCoFrw4aJyQx4-aHSmgYuw_DOgzSfK5NvP-vBT2D2qFG6y3d3dlW4wUdBDqfZauxu8veGzjF6VP4gaUlRb0W97NTklmxhF1ptmHD9ffPNwTXfkEKc0gdrU82LOfhcGwG-3e4BJtVtc3Lxtd9Z_zLOlPfwI7twXk8kgPFa3yg6g2Vy5rgaQxYAY4WufHTUJ8c1B06O5NM6gA87U-sE4p9Alg46qwzjs5QITV2xa9-GlT3j34ND3x0cD7VuBTYg1kZMtPNYHOU5wxcURTh30ZZL6qg7zTMkzWi4PtwBM16YOryUtQ-Yz8JbIeHnwai25uHzLJ-jDZQCsrORX0wDnWaH-lg0cbT5E2Koubmgg7d5x5EhS_Ic6Dua9hJ7hCvQ1TDYMduz8vjGC2dwZbA1X_aoRgAcbjUJ-2X7g08yaLIW-luBCENDPeF04GV-ngK_4davNKYbLvJYzx6MlcWEgaPace2Q_nJINJFk-47vv2I1sNrraHeZcFEvQLN88WZ--qK_nBoY7ofOdNArNYZVSIjdISTZrwTYtkkRCm4dt6Mr82jkEp2CA8mEXBguUZ13PqXy-3FhF4vhdtjq0YwGMbnVr2EVH7mBK_VUAwN7ZwkvJckxOnSVoReuY9TQy26r_JR8QQ4U-hY2g6QGbQXF6CfuLBUHI3LPfarU58WVF1BaLIA257q4E5l-cZ19w_4dTGdJrZMxipshPSWI1tcyevjB6e9uusUXbqyD9CPBbviRkDo7RIwcrvBGoXi2cddFYYw3KUSx_hUzIxzii2HaeJb5Muigo3FAIumZYk3sCv5C7b_4UUKonFxqp4cdS1B11dAlRLUcI9Ne18fG6sWvmoDgSiSYbRNQLi3hxN-UG3anzk0s5F01dlao7jWAa1Q94pdtxBGUOSzCF8kGQmk_6HYzv7hMymWEZ_V4If5DA9GDMr9htYIHFs8cTSViOwMmGXVCKox5KuACWqGugx2MycQp63sDart6JsFk1JkTtCk1l8bC99DN9YcDPJLCeKR1RqgYVbZZQ5Ik-kSaNigWLUJ73pUEBAC8H68owIQvufIo-fdmVhtxAOajkLCpKpURgBmsnNEi8lQxKmm9Lv5S0XXKAQD3bhaic7e9IlVMC7eQSk3QgPeaKI-NmWPUHbNgkXZaluSL4pQWEl3OQiDr1a0eZ-CxGTYsA==.G2Qz6c3BO9wzB4rRWFCDYb2HB6c6UO3raedy7MxwVLI=</keystore>
        </signing-key>
      </signing-keys>
      <signature-verification-keys>
        <signature-verification-key>
          <id>default-signature-verification-key</id>
          <keystore>data:application/pem;aes,v:S.QmVLMXl0RmxyUWx1NER3TA==.300c_IsPgvt2lMuWb6WOWg==.b_gfriLZdiYVNqJMfCYUhKdxmcGYoUau3-j94NueQ8A61jIPs7VOvYfFBnZEcKkv-LuhVEczqXuZK_7OjOi9_NDPbFOsvUqOOSpFkVotKiz1JQBXMFQxKWXs3qDhW4WXrihEATEG_Jfu82rM3sxvhIITLoIMQya-I77ZzdgBLQP8Lo0iJO6LBPWID-MldUYS10d4sfgY-_XRvmLdv-dfsqTcaYw3QfTGvHbU-SNXwnCYIx9cvSWwRqUSoyYTYrfAmm62LowKoS_Mhno_HrypTc8I_BSO6hFWsKCtu4qQEX3ycHQvDTyWyAhjbW--IbsVPvrpG-rUQUL1r9CsN7h4Vv-pFmi96OIUo62rhaEZ3QBkhabIVcFB5lv1QGfWIOqvXpKfWTAF04I_AwVL7oSTIK5S0DfB-Yt2zti4tnRA0Ge1UQfX3SpxXI5y0Hc5B8t-FvFMBVepEviVVdZDKG13JshjELp78E4rEyH2alH0Zu5DFS_M687s6dEyxKnouIGU95Km32d4pCj1KtCHwU3IU2jJxkLVG17rxLwCk4Y8bLPTF3cHVxZsEOB1TAT6Erw8ke687yWBFkIxcUmzMO3czCnEvm5f_jbCemWPb17Sw5yLL7iL8FBxNSaEa1qKHbsp0_l_4sRT4wMAuUmvGJF8MNTRT-EqlmSnkdaXRJnSeGLspojgAWxLICy_TdH_noZlrwZhE9w7AB9cIccEyAum7-3bXHoybFGZ-jw03ZwilWXPLT0YHMDk6zYoQx0lMI3RPGsHIfzorFekHqrR7gasoYHqHqwejpIOg-pO_QN2G6wofRfWIqvAMl7iBUZRjycn4jZTTEJnxhJp4bCBSCyWKGjGDSvi4dU-Odkvx_GT1W1myxN0LZ0tgu_MD4b9kRVlL4p95Z-l2QPRltUheW3vlJj_BT1uxCpPQSov553qOysDEWikECKSdkn7RDBpDy7QOmqMmtB0zqDBwqYXp5W44TfWEMU4jdD4gb2hrwkd9lWHVxZ96Zn1xyU7U_7Vi1uz-Ck9qho9wZbIyGZPgI160p9vdWwjP2mJscreeGZ6Sx7U7vBoTG3793KIn9RVLtIOnmBybT1EgdhdhvWt-S0kZl2cr10NRdOT7oMcBzjcvPnEutkbssRK_UpwSclyU72I-VbWgsAjbuB0pOUtFyg6gUbVcz_Iz6278gEMn09GcKyVjJ3UmTZkQT6A3oUQy_17fXxM2oAP8V0paFe7NHPTSjS4o4tbr5aYKy_WlLuXxUTRpXmCU8R2lhf19NKtglMcvHGXDhoHRttQ9Oauuk0wxVb4UDz1OLHCWGsM4Qtdq6rezaxJz3GhJMMZccsZ-6QaN9lynZrBGRlkk0QoiiKjkxh077QM_OU2azptszzCCH0Ytu63wAMLehF4bsIv2Q9L4CmBtFN19DLrqaUoU5tMZhuX0aU0mIGvVbrAs5yZ5N-zfTaFRj2R7HGlyyZjlqAe-ptqwwF-nSiRlXozWuzi1DYfXS8r-WozoMxJwqKb8JRXBwShyGQtyRcdTNhs3s9UaCSKWEcyrnzn6Pi3XHzw_iR4CJqhxiPIV_fFeAqxYsGqj_2XBrzmNNxxRqyAPNhP8m32yEDF2lvcf66dI4_I_tj62Y9bhfDBCmpGD5JN9fwiUf7zfmh_58XjUJk_OSpRE8KWAqHgtE02AXyi3V829j9U12TOW2iRyXBDr-_WWt8=.YfAB6YnEqN0bljH1MNpMel2xFJbLRqGanRxNOIK9XE8=</keystore>
        </signature-verification-key>
      </signature-verification-keys>
    </crypto>
    <caching-services>
      <default-caching-service>
        <data-source>default-datasource</data-source>
      </default-caching-service>
    </caching-services>
  </facilities>
  <processing xmlns="https://curity.se/ns/conf/base">
    <procedures>
      <pre-processing-procedure>
        <id>test-obb</id>
        <script>LyoKICogQ29weXJpZ2h0IChDKSAyMDIxIEN1cml0eSBBQi4gQWxsIHJpZ2h0cyByZXNlcnZlZC4KICoKICogVGhlIGNvbnRlbnRzIG9mIHRoaXMgZmlsZSBhcmUgdGhlIHByb3BlcnR5IG9mIEN1cml0eSBBQi4KICogWW91IG1heSBub3QgY29weSBvciB1c2UgdGhpcyBmaWxlLCBpbiBlaXRoZXIgc291cmNlIGNvZGUKICogb3IgZXhlY3V0YWJsZSBmb3JtLCBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRlcm1zCiAqIHNldCBieSBDdXJpdHkgQUIuCiAqCiAqIEZvciBmdXJ0aGVyIGluZm9ybWF0aW9uLCBwbGVhc2UgY29udGFjdCBDdXJpdHkgQUIuCiAqLwoKLy9Ob3RlOiBFUzUhCmZ1bmN0aW9uIHJlc3VsdChjb250ZXh0KSB7CiAgICB2YXIgbWF4aW11bUxpZmV0aW1lSW5TZWNvbmRzID0gNjAqNTsKICAgIHZhciByZXF1aXJlZFNpZ25hdHVyZUFsZ29yaXRobSA9ICJQUzI1NiI7CgogICAgdmFyIHJlZ2lzdHJhdGlvbkRhdGEgPSBjb250ZXh0LmdldFJlZ2lzdHJhdGlvbkRhdGEoKTsKICAgIHZhciByZWRpcmVjdFVyaXNSYXcgPSByZWdpc3RyYXRpb25EYXRhLnJlZGlyZWN0X3VyaXM7CiAgICB2YXIgandrcyA9IHJlZ2lzdHJhdGlvbkRhdGEuandrczsKICAgIHZhciBqd2tzVXJpID0gcmVnaXN0cmF0aW9uRGF0YS5qd2tzX3VyaTsKICAgIHZhciBzY29wZSA9IHJlZ2lzdHJhdGlvbkRhdGEuc2NvcGU7CiAgICB2YXIgc29mdHdhcmVTdGF0ZW1lbnQgPSByZWdpc3RyYXRpb25EYXRhLnNvZnR3YXJlX3N0YXRlbWVudDsKCiAgICB2YXIgaXNSb2xlUGFndG8gPSBmYWxzZTsKICAgIHZhciBpc1JvbGVEYWRvcyA9IGZhbHNlOwogICAgdmFyIGlzUm9sZUNvbnRhID0gZmFsc2U7CiAgICB2YXIgaXNSb2xlQ2NvcnIgPSBmYWxzZTsKCiAgICB2YXIgc2NvcGVzID0gc2NvcGUgPyBzY29wZS5zcGxpdFsnICddIDogW107CgovLz09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CiAgICAvKgogICAgICAgIHNoYWxsIHJlamVjdCBkeW5hbWljIGNsaWVudCByZWdpc3RyYXRpb24gcmVxdWVzdHMgbm90IHBlcmZvcm1lZCBvdmVyIGEgY29ubmVjdGlvbiBzZWN1cmVkIHdpdGggbXV0dWFsIHRscyB1c2luZyBjZXJ0aWZpY2F0ZXMgaXNzdWVkIGJ5IEJyYXppbCBJQ1AgKHByb2R1Y3Rpb24pIG9yIHRoZSBEaXJlY3Rvcnkgb2YgUGFydGljaXBhbnRzIChzYW5kYm94KTsKICAgICAgICBzaGFsbCB2YWxpZGF0ZSB0aGF0IHRoZSByZXF1ZXN0IGNvbnRhaW5zIHNvZnR3YXJlX3N0YXRlbWVudCBKV1Qgc2lnbmVkIHVzaW5nIHRoZSBQUzI1NiBhbGdvcml0aGltIGlzc3VlZCBieSB0aGUgT3BlbiBCYW5raW5nIEJyYXNpbCBkaXJlY3Rvcnkgb2YgcGFydGljaXBhbnRzOwogICAgICAgIHNoYWxsIHZhbGlkYXRlIHRoYXQgdGhlIHNvZnR3YXJlX3N0YXRlbWVudCB3YXMgaXNzdWVkIChpYXQpIG5vdCBtb3JlIHRoYW4gNSBtaW51dGVzIHByaW9yIHRvIHRoZSByZXF1ZXN0IGJlaW5nIHJlY2VpdmVkOwogICAgICAgIHNoYWxsIHZhbGlkYXRlIHRoYXQgYSBqd2tzIChrZXkgc2V0IGJ5IHZhbHVlKSB3YXMgbm90IGluY2x1ZGVkOwogICAgICAgIHNoYWxsIHJlcXVpcmUgYW5kIHZhbGlkYXRlIHRoYXQgdGhlIGp3a3NfdXJpIG1hdGNoZXMgdGhlIHNvZnR3YXJlX2p3a3NfdXJpIHByb3ZpZGVkIGluIHRoZSBzb2Z0d2FyZSBzdGF0ZW1lbnQ7CiAgICAgICAgc2hhbGwgcmVxdWlyZSBhbmQgdmFsaWRhdGUgdGhhdCByZWRpcmVjdF91cmlzIG1hdGNoIG9yIGNvbnRhaW4gYSBzdWIgc2V0IG9mIHNvZnR3YXJlX3JlZGlyZWN0X3VyaXMgcHJvdmlkZWQgaW4gdGhlIHNvZnR3YXJlIHN0YXRlbWVudDsKICAgICAgICBzaGFsbCByZXF1aXJlIGFuZCB2YWxpZGF0ZSB0aGF0IGFsbCBjbGllbnQgYXV0aGVudGljYXRpb24gbWVjaGFuaXNtIGFkaGVyZSB0byB0aGUgcmVxdWlyZW1lbnRzIGRlZmluZWQgaW4gRmluYW5jaWFsLWdyYWRlIEFQSSBTZWN1cml0eSBQcm9maWxlIDEuMCAtIFBhcnQgMTogQWR2YW5jZWQ7CiAgICAgICAgc2hhbGwgcmVxdWlyZSBlbmNyeXB0ZWQgcmVxdWVzdCBvYmplY3RzIGFzIHJlcXVpcmVkIGJ5IHRoZSBCcmFzaWwgT3BlbiBCYW5raW5nIFNlY3VyaXR5IFByb2ZpbGU7CiAgICAgICAgc2hhbGwgdmFsaWRhdGUgdGhhdCByZXF1ZXN0ZWQgc2NvcGVzIGFyZSBhcHByb3ByaWF0ZSBmb3IgdGhlIHNvZnR3YXJlcyBhdXRob3JpemVkIHJlZ3VsYXRvcnkgcm9sZXM7CiAgICAgICAgc2hvdWxkIHdoZXJlIHBvc3NpYmxlIHZhbGlkYXRlIGNsaWVudCBhc3NlcnRlZCBtZXRhZGF0YSBhZ2FpbnN0IG1ldGFkYXRhIHByb3ZpZGVkIGluIHRoZSBzb2Z0d2FyZV9zdGF0ZW1lbnQ7CiAgICAgICAgc2hhbGwgYWNjZXB0IGFsbCB4LjUwMCBBdHRyaWJ1dGVUeXBlIG5hbWUgc3RyaW5ncyBkZWZpbmVkIGluIHRoZSBEaXN0aW5ndWlzaGVkIE5hbWUgb2YgdGhlIHguNTA5IENlcnRpZmljYXRlIFByb2ZpbGVzIGRlZmluZWQgaW4gW09wZW4gQmFua2luZyBCcmFzaWwgeC41MDkgQ2VydGlmaWNhdGUgU3RhbmRhcmRzXVtPQkItQ2VydC1TdGFuZGFyZHNdOwogICAgICAgIGlmIHN1cHBvcnRpbmcgdGxzX2NsaWVudF9hdXRoIGNsaWVudCBhdXRoZW50aWNhdGlvbiBtZWNoYW5pc20gYXMgZGVmaW5lZCBpbiBbUkZDODcwNV0gc2hhbGwgb25seSBhY2NlcHQgdGxzX2NsaWVudF9hdXRoX3N1YmplY3RfZG4gYXMgYW4gaW5kaWNhdGlvbiBvZiB0aGUgY2VydGlmaWNhdGUgc3ViamVjdCB2YWx1ZSBhcyBkZWZpbmVkIGluIGNsYXVzZSAyLjEuMiBbUkZDODcwNV07CiAgICAqLwovLz09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CgoKLy89PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQovLyBzaGFsbCB2YWxpZGF0ZSB0aGF0IHRoZSByZXF1ZXN0IGNvbnRhaW5zIHNvZnR3YXJlX3N0YXRlbWVudCBKV1Qgc2lnbmVkIHVzaW5nIHRoZSBQUzI1NiBhbGdvcml0aGltIGlzc3VlZCBieSB0aGUgT3BlbiBCYW5raW5nIEJyYXNpbCBkaXJlY3Rvcnkgb2YgcGFydGljaXBhbnRzOwoKICAgIGlmICghc29mdHdhcmVTdGF0ZW1lbnQpIHsKICAgICAgICB0aHJvdyBleGNlcHRpb25GYWN0b3J5LmJhZFJlcXVlc3RFeGNlcHRpb24oIk1pc3Npbmcgc29mdHdhcmVfc3RhdGVtZW50IGluIHJlcXVlc3QuIik7CiAgICB9CiAgICAvKgogICAgICAgIHZhciBqd3RIZWFkZXIgPSBiYXNlNjREZWNvZGUoc29mdHdhcmVTdGF0ZW1lbnQuc3BsaXQoJy4nKVswXSk7CiAgICAgICAgdmFyIHNzYU1ldGFkYXRhID0gY29udGV4dC5qc29uLmZyb21Kc29uKGp3dEhlYWRlcik7CgogICAgICAgIGlmIChzc2FNZXRhZGF0YS5hbGcgIT0gcmVxdWlyZWRTaWduYXR1cmVBbGdvcml0aG0pIHsKICAgICAgICAgICAgdGhyb3cgZXhjZXB0aW9uRmFjdG9yeS5iYWRSZXF1ZXN0RXhjZXB0aW9uKCJVbmV4cGVjdGVkIHNpZ25hdHVyZSBhbGdvcml0aG0gd2FzIGZvdW5kIGluIHNvZnR3YXJlIHN0YXRlbWVudCBhc3NlcnRpb24uIik7CiAgICAgICAgfQogICAgKi8KCiAgICAvLyBUT0RPOiBEaXNjdXNzIHdoZW4gdG8gdmFsaWRhdGUgc2lnbmF0dXJlIGFzIGl0cyB0aW1lIGNvbnN1bWluZwogICAgCiAgICB2YXIgc3NhID0gY29udGV4dC52YWxpZGF0ZVNpZ25hdHVyZUFuZEV4dHJhY3RDbGFpbXMoIm9iYi1wcm9kdWN0aW9uLXNzYS1pc3N1ZXIiLCBzb2Z0d2FyZVN0YXRlbWVudCwge2FjY2VwdGVkQWxnb3JpdGhtczogW3JlcXVpcmVkU2lnbmF0dXJlQWxnb3JpdGhtLCAiUlNBMjU2Il19KTsKCiAgICBpZiAoIXNzYSB8fCBzc2Euc2l6ZSgpID09IDApIHsKICAgICAgICB0aHJvdyBleGNlcHRpb25GYWN0b3J5LmJhZFJlcXVlc3RFeGNlcHRpb24oIlZhbGlkYXRpb24gb2Ygc29mdHdhcmUgc3RhdGVtZW50IGFzc2VydGlvbiBmYWlsZWQuIik7CiAgICB9CgovLz09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09Ci8vIHNoYWxsIHZhbGlkYXRlIHRoYXQgdGhlIHNvZnR3YXJlX3N0YXRlbWVudCB3YXMgaXNzdWVkIChpYXQpIG5vdCBtb3JlIHRoYW4gNSBtaW51dGVzIHByaW9yIHRvIHRoZSByZXF1ZXN0IGJlaW5nIHJlY2VpdmVkOwoKICAgIHZhciBpYXQgPSBzc2EuaWF0OwogICAgLy8gVE9ETzogZW5hYmxlOyBkaXNhYmxlZCBzbyB0aGF0IHdlIGNhbiByZXVzZSB0aGUgc2FtZSBzc2EgZm9yIHRlc3RpbmcuCiAgICAKICAgIGlmIChzZWNvbmRzU2luY2UoaWF0KSA+IG1heGltdW1MaWZldGltZUluU2Vjb25kcykgewogICAgICAgIC8vdGhyb3cgZXhjZXB0aW9uRmFjdG9yeS5iYWRSZXF1ZXN0RXhjZXB0aW9uKCJUaGUgc29mdHdhcmUgc3RhdGVtZW50IGFzc2VydGlvbiBpcyB0b28gb2xkLiIpOwogICAgfQoKLy89PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQovLyBub3QgZXhwbGljaXRlbHkgcmVxdWVzdGVkIGJ1dCBhIHNlbnRpdHkgY2hlY2sgb2YgdGhlIGVjb3N5c3RlbTogb25seSBjZXJ0aWZpY2F0ZXMgbWF0Y2hpbmcgc29mdHdhcmUgc3RhdGVtZW50IGFyZSBhbGxvd2VkIHRvIHVzZSB0aGUgc2FtZQoKICAgIHZhciBjbGllbnRDZXJ0ID0gY29udGV4dC5nZXRDbGllbnRDZXJ0aWZpY2F0ZSgpOwogICAgLy90aHJvdyBjbGllbnRDZXJ0CgogICAgdmFyIHN1YmplY3REbiA9IGNsaWVudENlcnQuZ2V0WDUwOUNlcnRpZmljYXRlKCk7CiAgICAKICAgIHZhciB1aWQgPSBzdWJqZWN0RG4ubWF0Y2goL3VpZD1bYS16MC05LV0rL2kpLnN1YnN0cmluZyg0KTsKICAgIAogICAgaWYgKHVpZCAhPSBzc2Euc29mdHdhcmVfaWQpIHsKICAgICAgICB0aHJvdyBleGNlcHRpb25GYWN0b3J5LmJhZFJlcXVlc3RFeGNlcHRpb24oIlVJRCBpbiBjZXJ0aWZpY2F0ZSBzdWJqZWN0IGRvZXMgbm90IG1hdGNoIHNvZnR3YXJlX2lkIGluIHNvZnR3YXJlIHN0YXRlbWVudCBhc3NlcnRpb24iKTsgICAKICAgIH0KCi8vPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KLy8gc2hhbGwgdmFsaWRhdGUgdGhhdCBhIGp3a3MgKGtleSBzZXQgYnkgdmFsdWUpIHdhcyBub3QgaW5jbHVkZWQ7CgogICAgaWYgKGp3a3MpIHsKICAgICAgICB0aHJvdyBleGNlcHRpb25GYWN0b3J5LmJhZFJlcXVlc3RFeGNlcHRpb24oIlJlcXVlc3QgbXVzdCBub3QgaW5jbHVkZSBqd2tzIik7CiAgICB9CgovLz09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09Ci8vIHNoYWxsIHJlcXVpcmUgYW5kIHZhbGlkYXRlIHRoYXQgdGhlIGp3a3NfdXJpIG1hdGNoZXMgdGhlIHNvZnR3YXJlX2p3a3NfdXJpIHByb3ZpZGVkIGluIHRoZSBzb2Z0d2FyZSBzdGF0ZW1lbnQ7CiAgICBpZiAoIWp3a3NVcmkpIHsKICAgICAgICB0aHJvdyBleGNlcHRpb25GYWN0b3J5LmJhZFJlcXVlc3RFeGNlcHRpb24oImp3a3NfdXJpIGlzIG1pc3NpbmcuIik7CiAgICB9CgogICAgaWYgKGp3a3NVcmkgIT0gc3NhLnNvZnR3YXJlX2p3a3NfdXJpKSB7CiAgICAgICAgdGhyb3cgZXhjZXB0aW9uRmFjdG9yeS5iYWRSZXF1ZXN0RXhjZXB0aW9uKCJqd2tzX3VyaSBkb2VzIG5vdCBtYXRjaCB0aGUgdmFsdWUgcHJvdmlkZWQgaW4gdGhlIHNvZnR3YXJlIHN0YXRlbWVudCBhc3NlcnRpb24uIik7CiAgICB9CgovLz09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09Ci8vIHNoYWxsIHJlcXVpcmUgYW5kIHZhbGlkYXRlIHRoYXQgcmVkaXJlY3RfdXJpcyBtYXRjaCBvciBjb250YWluIGEgc3ViIHNldCBvZiBzb2Z0d2FyZV9yZWRpcmVjdF91cmlzIHByb3ZpZGVkIGluIHRoZSBzb2Z0d2FyZSBzdGF0ZW1lbnQ7CgogICAgdmFyIHJlZ2lzdGVyZWRTb2Z0d2FyZVJlZGlyZWN0VXJpcyA9IHNzYS5zb2Z0d2FyZV9yZWRpcmVjdF91cmlzOwoKICAgIC8vIHVzZSBmb3IgbG9vcCBiZWNhdXNlIHJlZGlyZWN0VXJpc1JhdyBpcyBvYmplY3QvbGlzdCBhbmQgbm90IEFycmF5CiAgICBmb3IgKHZhciBpbmRleCBpbiByZWRpcmVjdFVyaXNSYXcpIHsKICAgICAgICB2YXIgcmVkaXJlY3RVcmkgPSByZWRpcmVjdFVyaXNSYXdbaW5kZXhdOwoKICAgICAgICBpZiAocmVnaXN0ZXJlZFNvZnR3YXJlUmVkaXJlY3RVcmlzLmluZGV4T2YocmVkaXJlY3RVcmkpID09IC0xKSB7CiAgICAgICAgICAgIHRocm93IGV4Y2VwdGlvbkZhY3RvcnkuYmFkUmVxdWVzdEV4Y2VwdGlvbigiQXQgbGVhc3Qgb25lIHJlZGlyZWN0IHVyaSBkb2VzIG5vdCBtYXRjaCB0aGUgbGlzdCBvZiByZWRpcmVjdCB1cmlzIHByb3ZpZGVkIGluIHRoZSBzb2Z0d2FyZSBzdGF0ZW1lbnQgYXNzZXJ0aW9uLiIpOwogICAgICAgIH0KICAgIH0KCi8vPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KLy8gc2hhbGwgcmVxdWlyZSBhbmQgdmFsaWRhdGUgdGhhdCBhbGwgY2xpZW50IGF1dGhlbnRpY2F0aW9uIG1lY2hhbmlzbSBhZGhlcmUgdG8gdGhlIHJlcXVpcmVtZW50cyBkZWZpbmVkIGluIEZpbmFuY2lhbC1ncmFkZSBBUEkgU2VjdXJpdHkgUHJvZmlsZSAxLjAgLSBQYXJ0IDE6IEFkdmFuY2VkOwovLyBGcm9tIEZBUEkgMS4wIC0gUGFydCAyOiBjbGF1c2UgNS4yLjItMTQKLy8gc2hhbGwgYXV0aGVudGljYXRlIHRoZSBjb25maWRlbnRpYWwgY2xpZW50IHVzaW5nIG9uZSBvZiB0aGUgZm9sbG93aW5nIG1ldGhvZHMgKHRoaXMgb3ZlcnJpZGVzIEZBUEkgU2VjdXJpdHkgUHJvZmlsZSAxLjAgLSBQYXJ0IDE6IEJhc2VsaW5lIGNsYXVzZSA1LjIuMi00KToKLy8gICB0bHNfY2xpZW50X2F1dGggb3Igc2VsZl9zaWduZWRfdGxzX2NsaWVudF9hdXRoIGFzIHNwZWNpZmllZCBpbiBzZWN0aW9uIDIgb2YgTVRMUywgb3IKLy8gICBwcml2YXRlX2tleV9qd3QgYXMgc3BlY2lmaWVkIGluIHNlY3Rpb24gOSBvZiBPSURDOwovLwovLyBzb2x2ZWQgYnkgY29uZmlndXJhdGlvbiBmb3IgY2xpZW50IGF1dGhlbnRpY2F0aW9uCgovLz09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09Ci8vIHNoYWxsIHJlcXVpcmUgZW5jcnlwdGVkIHJlcXVlc3Qgb2JqZWN0cyBhcyByZXF1aXJlZCBieSB0aGUgQnJhc2lsIE9wZW4gQmFua2luZyBTZWN1cml0eSBQcm9maWxlOwovLwovLyBub3QgYXBwbGljYWJsZSBpbiBEQ1IgY29udGV4dAoKLy89PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQovLyBzaGFsbCB2YWxpZGF0ZSB0aGF0IHJlcXVlc3RlZCBzY29wZXMgYXJlIGFwcHJvcHJpYXRlIGZvciB0aGUgc29mdHdhcmVzIGF1dGhvcml6ZWQgcmVndWxhdG9yeSByb2xlczsKLy8gREFET1M6IG9wZW5pZCAgICAgICAgICBjb25zZW50cyByZXNvdXJjZXMgYWNjb3VudHMgY3JlZGl0LWNhcmRzLWFjY291bnRzIGN1c3RvbWVycyBpbnZvaWNlLWZpbmFuY2luZ3MgZmluYW5jaW5ncyBsb2FucyB1bmFycmFuZ2VkLWFjY291bnRzLW92ZXJkcmFmdAovLyBQQUdUTzogb3BlbmlkIHBheW1lbnRzIGNvbnNlbnRzIHJlc291cmNlcwovLyBDT05UQTogb3BlbmlkCi8vIENDT1JSOiBvcGVuaWQKCiAgICB2YXIgcmVndWxhdG9yeVJvbGVzID0gc3NhLnNvZnR3YXJlX3JvbGVzOwoKICAgIGlzUm9sZURhZG9zID0gcmVndWxhdG9yeVJvbGVzLmluZGV4T2YoIkRBRE9TIikgIT0gLTE7CiAgICBpc1JvbGVQYWd0byA9IHJlZ3VsYXRvcnlSb2xlcy5pbmRleE9mKCJQQUdUTyIpICE9IC0xOwogICAgaXNSb2xlQ29udGEgPSByZWd1bGF0b3J5Um9sZXMuaW5kZXhPZigiQ09OVEEiKSAhPSAtMTsKICAgIGlzUm9sZUNjb3JyID0gcmVndWxhdG9yeVJvbGVzLmluZGV4T2YoIkNDT1JSIikgIT0gLTE7CgogICAgaWYgKHNjb3Blcy5sZW5ndGggIT0gMCkgewogICAgICAgIHNjb3BlcyA9IHNjb3BlLnNwbGl0KCcgJyk7CiAgICAgICAgdmFyIGZvdW5kSW52YWxpZFNjb3BlID0gc2NvcGVzLnNvbWUoZnVuY3Rpb24gKGVsZW1lbnQpIHsKICAgICAgICAgICAgdmFyIGlzVmFsaWRTY29wZSA9IGZhbHNlOwogICAgICAgICAgICBzd2l0Y2goZWxlbWVudCkgewogICAgICAgICAgICAgICAgY2FzZSAicGF5bWVudHMiOgogICAgICAgICAgICAgICAgICAgIC8vIHBheW1lbnRzIGlzIHZhbGlkIHNjb3BlIGlmIGxpc3Qgb2YgcmVndWxhdG9yeSByb2xlcyBpbmNsdWRlcyBQQUdUTwogICAgICAgICAgICAgICAgICAgIGlzVmFsaWRTY29wZSA9IGlzUm9sZVBhZ3RvOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSAicmVzb3VyY2VzIjoKICAgICAgICAgICAgICAgIGNhc2UgImNvbnNlbnRzIjoKICAgICAgICAgICAgICAgICAgICAvLyByZXNvdXJjZXMgYW5kIGNvbnNlbnRzIGFyZSB2YWxpZCBzY29wZXMgaWYgbGlzdCBvZiByZWd1bGF0b3J5IHJvbGVzIGluY2x1ZGVzIFBBR1RPIG9yIERBRE9TCiAgICAgICAgICAgICAgICAgICAgaXNWYWxpZFNjb3BlID0gaXNSb2xlUGFndG8gfHwgaXNSb2xlRGFkb3M7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlICJhY2NvdW50cyI6CiAgICAgICAgICAgICAgICBjYXNlICJjcmVkaXQtY2FyZHMtYWNjb3VudHMiOgogICAgICAgICAgICAgICAgY2FzZSAiY3VzdG9tZXJzIjoKICAgICAgICAgICAgICAgIGNhc2UgImludm9pY2UtZmluYW5jaW5ncyI6CiAgICAgICAgICAgICAgICBjYXNlICJmaW5hbmNpbmdzIjoKICAgICAgICAgICAgICAgIGNhc2UgImxvYW5zIjoKICAgICAgICAgICAgICAgIGNhc2UgInVuYXJyYW5nZWQtYWNjb3VudHMtb3ZlcmRyYWZ0IjoKICAgICAgICAgICAgICAgICAgICAvLyBhbnkgb2YgdGhlIHNjb3BlcyBhYm92ZSBpcyBhIHZhbGlkIHNjb3BlIGlmIHRoZSBsaXN0IG9mIHJlZ3VsYXRvcnkgcm9sZXMgaW5jbHVkZXMgREFET1MKICAgICAgICAgICAgICAgICAgICBpc1ZhbGlkU2NvcGUgPSBpc1JvbGVEYWRvczsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgIm9wZW5pZCI6CiAgICAgICAgICAgICAgICAgICAgLy8gZm9yIHRoZSBzYWtlIG9mIGNvbXBsZXRlbmVzcwogICAgICAgICAgICAgICAgICAgIGlzVmFsaWRTY29wZSA9IHRydWU7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAgICAgIC8vIGN1c3RvbSBzY29wZSBhbHdheXMgdmFsaWQKICAgICAgICAgICAgICAgICAgICBpc1ZhbGlkU2NvcGUgPSB0cnVlOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyBmb3VuZCBpbnZhbGlkIHNjb3BlCiAgICAgICAgICAgIHJldHVybiAhaXNWYWxpZFNjb3BlOwogICAgICAgIH0pOwoKICAgICAgICBpZiAoZm91bmRJbnZhbGlkU2NvcGUpIHsKICAgICAgICAgICAgdGhyb3cgZXhjZXB0aW9uRmFjdG9yeS5iYWRSZXF1ZXN0RXhjZXB0aW9uKCJVbmF1dGhvcml6ZWQgc2NvcGUocykgcmVxdWVzdGVkLiIpOwogICAgICAgIH0KICAgIH0KCi8vPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KLy8gc2hvdWxkIHdoZXJlIHBvc3NpYmxlIHZhbGlkYXRlIGNsaWVudCBhc3NlcnRlZCBtZXRhZGF0YSBhZ2FpbnN0IG1ldGFkYXRhIHByb3ZpZGVkIGluIHRoZSBzb2Z0d2FyZV9zdGF0ZW1lbnQ7Ci8vIGlmIHN1cHBvcnRpbmcgdGxzX2NsaWVudF9hdXRoIGNsaWVudCBhdXRoZW50aWNhdGlvbiBtZWNoYW5pc20gYXMgZGVmaW5lZCBpbiBbUkZDODcwNV0gc2hhbGwgb25seSBhY2NlcHQgdGxzX2NsaWVudF9hdXRoX3N1YmplY3RfZG4gYXMgYW4gaW5kaWNhdGlvbiBvZiB0aGUgY2VydGlmaWNhdGUgc3ViamVjdCB2YWx1ZSBhcyBkZWZpbmVkIGluIGNsYXVzZSAyLjEuMiBbUkZDODcwNV07CiAgICByZWdpc3RyYXRpb25EYXRhLmZvckVhY2goZnVuY3Rpb24oa2V5LCB2YWx1ZSkKICAgIHsKICAgICAgICAvLyBUT0RPOiBjaGVjayBpZiB0aGF0IGNhbiBiZSBzb2x2ZWQgYnkgc2VydmVyIGNvbmZpZ3VyYXRpb24gZm9yIG5vbi10ZW1wbGF0aXplZCBjbGllbnRzCiAgICAgICAgaWYgKGtleS5zdGFydHNXaXRoKCJ0bHNfY2xpZW50X2F1dGhfIikgJiYga2V5ICE9ICJ0bHNfY2xpZW50X2F1dGhfc3ViamVjdF9kbiIpIHsKICAgICAgICAgICAgdGhyb3cgZXhjZXB0aW9uRmFjdG9yeS5iYWRSZXF1ZXN0RXhjZXB0aW9uKCJPbmx5IHRsc19jbGllbnRfYXV0aF9zdWJqZWN0X2RuIGlzIGFsbG93ZWQgZm9yIGluZGljYXRpb24gb2YgdGhlIGNlcnRpZmljYXRlIHN1YmplY3QuIik7CiAgICAgICAgfQoKICAgICAgICB2YXIgc3NhVmFsdWU7CgogICAgICAgIHN3aXRjaCAoa2V5KSB7CiAgICAgICAgICAgIGNhc2UgImp3a3NfdXJpIjoKICAgICAgICAgICAgY2FzZSAicmVkaXJlY3RfdXJpcyI6CiAgICAgICAgICAgIGNhc2UgInNvZnR3YXJlX3N0YXRlbWVudCI6CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSAic29mdHdhcmVfaWQiOgogICAgICAgICAgICBjYXNlICJzb2Z0d2FyZV92ZXJzaW9uIjoKICAgICAgICAgICAgICAgIHNzYVZhbHVlID0gc3NhW2tleV07CiAgICAgICAgICAgICAgICBpZiAoc3NhVmFsdWUgJiYgdmFsdWUgIT0gc3NhVmFsdWUpIHsKICAgICAgICAgICAgICAgICAgICB0aHJvdyBleGNlcHRpb25GYWN0b3J5LmJhZFJlcXVlc3RFeGNlcHRpb24oa2V5ICsgIiBkb2VzIG5vdCBtYXRjaCB0aGUgdmFsdWUgcHJvdmlkZWQgaW4gdGhlIHNvZnR3YXJlIHN0YXRlbWVudCBhc3NlcnRpb24uIik7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgIHNzYVZhbHVlID0gc3NhWyJzb2Z0d2FyZV8iICsga2V5XTsKICAgICAgICAgICAgICAgIGlmIChzc2FWYWx1ZSAmJiB2YWx1ZSAhPSBzc2FWYWx1ZSkgewogICAgICAgICAgICAgICAgICAgIHRocm93IGV4Y2VwdGlvbkZhY3RvcnkuYmFkUmVxdWVzdEV4Y2VwdGlvbihrZXkgKyAiIGRvZXMgbm90IG1hdGNoIHRoZSB2YWx1ZSBwcm92aWRlZCBpbiB0aGUgc29mdHdhcmUgc3RhdGVtZW50IGFzc2VydGlvbi4iKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgIH0pOwoKLy89PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQovLyBzaGFsbCBhY2NlcHQgYWxsIHguNTAwIEF0dHJpYnV0ZVR5cGUgbmFtZSBzdHJpbmdzIGRlZmluZWQgaW4gdGhlIERpc3Rpbmd1aXNoZWQgTmFtZSBvZiB0aGUgeC41MDkgQ2VydGlmaWNhdGUgUHJvZmlsZXMgZGVmaW5lZCBpbiBbT3BlbiBCYW5raW5nIEJyYXNpbCB4LjUwOSBDZXJ0aWZpY2F0ZSBTdGFuZGFyZHNdW09CQi1DZXJ0LVN0YW5kYXJkc107Ci8vIHNoYWxsIHNlbGVjdCBhbmQgYXBwbHkgdGhlIGVuY3J5cHRpb24gYWxnb3JpdGhtIGFuZCBjaXBoZXIgY2hvaWNlIGZyb20gdGhlIG1vc3QgcmVjb21tZW5kZWQgb2YgdGhlIElBTkEgY2lwaGVyIHN1aXRlcyB0aGF0IGlzIHN1cHBvcnRlZCBieSB0aGUgQXV0aG9yaXNhdGlvbiBTZXJ2ZXI7Ci8vCi8vIHNvbHZlZCBieSBzZXJ2ZXIgY29uZmlndXJhdGlvbgovLyBUT0RPOiBjcmVhdGUgY2VydGlmaWNhdGVzIHRoYXQgbWVldCByZXF1aXJlbWVudHMgYW5kIHRlc3Qgc3ViamVjdCBETgoKCi8vPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KLy8gc2hhbGwgcG9wdWxhdGUgZGVmYXVsdHMgZnJvbSB2YWx1ZXMgd2l0aGluIHRoZSBzb2Z0d2FyZSBzdGF0ZW1lbnQgYXNzZXJ0aW9uIHdoZXJlIHBvc3NpYmxlOwogICAgLyogaWRlbnRpZnkgcG9zc2libGUvYXBwbGljYWJsZSBkZWZhdWx0czoKICAgICAgICBjbGllbnRfbmFtZQogICAgICAgIGNsaWVudF91cmkKICAgICAgICBqd2tzX3VyaQogICAgICAgIGxvZ29fdXJpCiAgICAgICAgcG9saWN5X3VyaQogICAgICAgIHRvc191cmkKICAgICAgICBzb2Z0d2FyZV9pZAogICAgICAgIHNvZnR3YXJlX3ZlcnNpb24KICAgICovCgogICAgLy8gb3ZlcndyaXRlIGV4aXN0aW5nIGFuZCBhZGQgbWlzc2luZwogICAgdmFyIGF0dHJpYnV0ZXMgPSB7CiAgICAgICAgY2xpZW50X25hbWU6IHNzYS5zb2Z0d2FyZV9jbGllbnRfbmFtZSwKICAgICAgICBjbGllbnRfdXJpOiBzc2Euc29mdHdhcmVfY2xpZW50X3VyaSwKICAgICAgICBqd2tzX3VyaTogc3NhLnNvZnR3YXJlX2p3a3NfdXJpLAogICAgICAgIGxvZ29fdXJpOiBzc2Euc29mdHdhcmVfbG9nb191cmksCiAgICAgICAgcG9saWN5X3VyaTogc3NhLnNvZnR3YXJlX3BvbGljeV91cmksCiAgICAgICAgdG9zX3VyaTogc3NhLnNvZnR3YXJlX3Rvc191cmksCgogICAgICAgIHNvZnR3YXJlX2lkOiBzc2Euc29mdHdhcmVfaWQsCiAgICAgICAgc29mdHdhcmVfdmVyc2lvbjogc3NhLnNvZnR3YXJlX3ZlcnNpb24KICAgIH0KCgovLz09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09Ci8vIHNoYWxsIGdyYW50IHRoZSBjbGllbnQgcGVybWlzc2lvbiB0byB0aGUgY29tcGxldGUgc2V0IG9mIHBvdGVudGlhbCBzY29wZXMgYmFzZWQgb24gdGhlIHNvZnR3YXJlcyByZWd1bGF0b3J5IHBlcm1pc3Npb25zIGluY2x1ZGVkIGluIHRoZSBzb2Z0d2FyZV9zdGF0ZW1lbnQ7CgogICAgdmFyIGF1dGhvcml6ZWRTY29wZXMgPSBbXTsKCiAgICBpZiAoaXNSb2xlRGFkb3MpIHsKICAgICAgICBhdXRob3JpemVkU2NvcGVzID0gWyJvcGVuaWQiLAogICAgICAgICAgICAiY29uc2VudHMiLAogICAgICAgICAgICAicmVzb3VyY2VzIiwKICAgICAgICAgICAgImFjY291bnRzIiwKICAgICAgICAgICAgImNyZWRpdC1jYXJkcy1hY2NvdW50cyIsCiAgICAgICAgICAgICJjdXN0b21lcnMiLAogICAgICAgICAgICAiaW52b2ljZS1maW5hbmNpbmdzIiwKICAgICAgICAgICAgImZpbmFuY2luZ3MiLAogICAgICAgICAgICAibG9hbnMiLAogICAgICAgICAgICAidW5hcnJhbmdlZC1hY2NvdW50cy1vdmVyZHJhZnQiXTsKCiAgICAgICAgaWYgKGlzUm9sZVBhZ3RvKSB7CiAgICAgICAgICAgIGF1dGhvcml6ZWRTY29wZXMucHVzaCgicGF5bWVudHMiKTsKICAgICAgICB9CiAgICB9IGVsc2UgaWYgKGlzUm9sZVBhZ3RvKSB7CiAgICAgICAgYXV0aG9yaXplZFNjb3BlcyA9IFsib3BlbmlkIiwgInBheW1lbnRzIiwgImNvbnNlbnRzIiwgInJlc291cmNlcyJdOwogICAgfSBlbHNlIGlmIChpc1JvbGVDb250YSB8fCBpc1JvbGVDY29ycikgewogICAgICAgIGF1dGhvcml6ZWRTY29wZXMgPSBbIiBvcGVuaWQiXTsKICAgIH0KCiAgICBhdXRob3JpemVkU2NvcGVzLmZvckVhY2goZnVuY3Rpb24oZWxlbWVudCkgewogICAgICAgIGlmIChzY29wZXMuaW5kZXhPZihlbGVtZW50KSA9PSAtMSkgewogICAgICAgICAgICBzY29wZXMucHVzaChlbGVtZW50KTsKICAgICAgICB9CiAgICB9KTsKCiAgICBpZiAoc2NvcGVzLmxlbmd0aCA+IDApIHsKICAgICAgICBhdHRyaWJ1dGVzLnNjb3BlID0gc2NvcGVzLmpvaW4oJyAnKTsKICAgIH0KCi8vPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KCiAgICByZXR1cm4gYXR0cmlidXRlczsKfQo=</script>
      </pre-processing-procedure>
    </procedures>
    <account-managers>
      <account-manager>
        <id>default-account-manager</id>
        <enable-registration>
          <account-verification-method>no-verification</account-verification-method>
        </enable-registration>
        <account-data-source>default-datasource</account-data-source>
      </account-manager>
    </account-managers>
    <credential-managers>
      <credential-manager>
        <id>default-credential-manager</id>
        <Sha2WithSha256>
        </Sha2WithSha256>
        <data-source-backed>
          <data-source-id>default-datasource</data-source-id>
        </data-source-backed>
      </credential-manager>
    </credential-managers>
  </processing>
  <nacm xmlns="urn:ietf:params:xml:ns:yang:ietf-netconf-acm">
    <write-default>permit</write-default>
    <groups>
      <group>
        <name>admin</name>
        <user-name>admin</user-name>
      </group>
    </groups>
    <rule-list>
      <name>admin</name>
      <group>admin</group>
      <rule>
        <name>any-access</name>
        <action>permit</action>
      </rule>
    </rule-list>
    <rule-list>
      <name>any-group</name>
      <group>*</group>
      <rule>
        <name>tailf-aaa-authentication</name>
        <module-name>tailf-aaa</module-name>
        <path>/aaa/authentication/users/user[name='$USER']</path>
        <access-operations>read update</access-operations>
        <action>permit</action>
      </rule>
      <rule>
        <name>tailf-aaa-user</name>
        <module-name>tailf-aaa</module-name>
        <path>/user[name='$USER']</path>
        <access-operations>create read update delete</access-operations>
        <action>permit</action>
      </rule>
      <rule>
        <name>tailf-webui-user</name>
        <module-name>tailf-webui</module-name>
        <path>/webui/data-stores/user-profile[username='$USER']</path>
        <access-operations>create read update delete</access-operations>
        <action>permit</action>
      </rule>
    </rule-list>
  </nacm>
  <aaa xmlns="http://tail-f.com/ns/aaa/1.1">
    <authentication>
      <users>
        <user>
          <name>admin</name>
          <uid>0</uid>
          <gid>0</gid>
          <password>$5$HY8fc01e$kBEvVh2XZn0LUgKYJQBYaKpenjHNzwVJwkwdZRc/YH5</password>
          <ssh_keydir>/opt/idsvr/home/admin/.ssh</ssh_keydir>
          <homedir>/opt/idsvr/home/admin</homedir>
        </user>
      </users>
    </authentication>
    <ios>
      <level>
        <nr>0</nr>
        <prompt>\h> </prompt>
      </level>
      <level>
        <nr>15</nr>
        <prompt>\h# </prompt>
      </level>
      <privilege>
        <mode>exec</mode>
        <level>
          <nr>0</nr>
          <command>
            <name>action</name>
          </command>
          <command>
            <name>autowizard</name>
          </command>
          <command>
            <name>enable</name>
          </command>
          <command>
            <name>exit</name>
          </command>
          <command>
            <name>help</name>
          </command>
          <command>
            <name>startup</name>
          </command>
        </level>
        <level>
          <nr>15</nr>
          <command>
            <name>configure</name>
          </command>
        </level>
      </privilege>
    </ios>
  </aaa>
</config>
